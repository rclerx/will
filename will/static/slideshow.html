<!DOCTYPE html>
<!--[if lt IE 7]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class='no-js' lang='en'>
<!--<![endif]-->
<head>
    <meta charset='utf-8' />
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible' />
    <title>Team Gallery</title>

    <meta content='Team Gallery' name='description' />
    <meta content='Ryan' name='author' />

    <meta name="distribution" content="global" />
    <meta name="language" content="en" />
    <meta content='width=device-width, initial-scale=1.0' name='viewport' />

    <link rel="stylesheet" href="/static/css/jquery.maximage.css?v=1.2" type="text/css" media="screen" charset="utf-8" />
    <link rel="stylesheet" href="/static/css/screen.css?v=1.2" type="text/css" media="screen" charset="utf-8" />

    <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

    <style type="text/css" media="screen">
        #maximage {
            /*				position:fixed !important;*/
        }

        /*Set my logo in bottom left*/
        #logo {
            bottom:30px;
            height:auto;
            left:30px;
            position:absolute;
            width:34%;
            z-index:1000;
        }
        #logo img {
            width:100%;
        }


    </style>

    <!--[if IE 6]>
			<style type="text/css" media="screen">
				/*I don't feel like messing with pngs for this browser... sorry*/
				#gradient {display:none;}
			</style>
		<![endif]-->
</head>
<body>

<div id="slideshow">
</div>

<script type="text/javascript" src='disabled-https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.js'></script>
<script type="text/javascript" src="/static/js/jquery-2.0.3.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.cycle.all.js" charset="utf-8"></script>
<script type="text/javascript" src="/static/js/jquery.maximage.js" charset="utf-8"></script>
<script type="text/javascript" src="/static/js/reconnecting-websocket.min.js"></script>
<script type="text/javascript" src="/static/js/application.js"></script>

<script type="text/javascript" charset="utf-8">

    $( document ).ready(function() {

        $.getJSON( "/pics", function( data ) {
            var items = [];
            $.each( data, function( key, val ) {
                console.log("Got a url: " + val);
                var img = $("<img src='" + val + "' width='2048' height='1536'/>");
                img.appendTo("#slideshow");

            });

            $(function(){
                // Trigger maximage
                jQuery('#slideshow').maximage({
                    cycleOptions: {
                        before: function (curr, next, opts) {
                            console.log("Transition from " + opts.currSlide + " to " + opts.nextSlide + " of " + opts.slideCount);
                        }
                    }
                });
            });

        });

        console.log( "SDG!" );

    });

    $(document).keyup(function(e) {
        console.log(e.which);
        if (e.which === 37) {
            console.log("Left");
            $('#slideshow').cycle('prev');
        }
        if (e.which === 39) {
            console.log("Right");
            $('#slideshow').cycle('next');
        }
        if (e.which === 8) {
            var deleted = $('div.mc-image').filter(function() {
                return $(this).css('opacity') == '1';
            });

            deleted.each(function(e) {
                var bg = $(this).css('background-image');
                var img = bg.replace('url(','').replace(')','').replace(/\"/gi, "");
                console.log("Deleting " + img);

                $.ajax({
                    url: "/pics",
                    type: 'DELETE',
                    data: { 'image': img }
                });
            });
            deleted.remove();
        }

    });

    $(document).unbind('keydown').bind('keydown', function (event) {
        if (event.keyCode === 8) {
            event.preventDefault();
            return false;
        }
    });

</script>


<script type="text/javascript">

    $(document).ready(function() {
        var $top = $('#top');
        var $document = $(document);
        var timer = null;
        var timerIsRunning = false;

        $top.hide();

        $('#menu').mousemove(function(e){
            e.stopPropagation();
        });
        setTimeout(function() {
            $document.mousemove(function(e) {
                if($top.is(':hidden')) {
                    $top.fadeIn();
                } else {
                    if(!timerIsRunning) {
                        timerIsRunning = true;
                        clearTimeout(timer);
                        timer = setTimeout(function() { $top.fadeOut();  }, 3000);
                        setTimeout(function() {timerIsRunning = false;}, 2000);
                    }
                }
            });
        }, 500);

    });

</script>
</head>
<body>

</body>
</html>
